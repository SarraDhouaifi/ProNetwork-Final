<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= job.title %> | ProNetwork</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <%- include('../partials/navbar') %>

    <div class="main-container" style="margin-top: 30px; display: flex; flex-direction: column; align-items: center; gap: 20px; padding-bottom: 50px;">
        
        <div class="card" style="padding: 40px; max-width: 850px; width: 100%; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
            
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 25px;">
                <div style="flex: 1;">
                    <h1 style="color: #0a66c2; font-size: 28px; margin-bottom: 8px;"><%= job.title %></h1>
                    <p style="font-size: 18px; font-weight: 600; color: #333; margin-bottom: 5px;">
                        <i class="fa-solid fa-building"></i> <%= job.company.companyName || job.company.firstName %>
                    </p>
                    <p style="color: #666; font-size: 15px;">
                        <i class="fa-solid fa-location-dot"></i> <%= job.location %> • 
                        <i class="fa-solid fa-clock"></i> <%= job.type %> • 
                        Posted on <%= new Date(job.createdAt).toLocaleDateString() %>
                    </p>
                </div>
                <img src="<%= job.company.profilePicture || '/assets/images/default.png' %>" 
                     style="width: 100px; height: 100px; border-radius: 12px; object-fit: cover; border: 1px solid #eee;">
            </div>

            <hr style="border: 0; border-top: 1px solid #eee; margin: 25px 0;">

            <div class="job-content">
                <h3 style="margin-bottom: 15px; color: #333;">Job Description</h3>
                <div style="line-height: 1.8; color: #444; white-space: pre-line; font-size: 16px;">
                    <%= job.description %>
                </div>
            </div>

            <hr style="border: 0; border-top: 1px solid #eee; margin: 30px 0;">

            <div style="display: flex; gap: 15px; align-items: center;">
                <% if (user && job.company._id.toString() === user._id.toString()) { %>
                    <a href="/jobs/<%= job._id %>/edit" class="btn-primary" style="background: #666; border: none; padding: 12px 25px; text-decoration: none; border-radius: 25px; color: white;">
                        <i class="fa-solid fa-pen"></i> Edit Job Listing
                    </a>
                    <p style="color: #666; font-size: 14px; margin-left: 10px;">
                        <strong><%= job.applicants.length %></strong> total candidate(s).
                    </p>
                <% } else { %>
                    <% if (job.applicants.some(applicant => applicant._id.toString() === user._id.toString())) { %>
                        <button class="btn-primary" style="background: #057642; border: none; padding: 12px 30px; border-radius: 25px; color: white; cursor: default;">
                            <i class="fa-solid fa-circle-check"></i> Application Sent
                        </button>
                    <% } else { %>
                        <form action="/jobs/<%= job._id %>/apply" method="POST">
                            <button type="submit" class="btn-primary" style="background: #0a66c2; border: none; padding: 12px 35px; border-radius: 25px; color: white; font-weight: 600; cursor: pointer;">
                                Apply Now
                            </button>
                        </form>
                    <% } %>
                <% } %>
            </div>
        </div>

        <% if (user && job.company._id.toString() === user._id.toString()) { %>
            <div class="card" style="padding: 30px; max-width: 850px; width: 100%; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
                <h3 style="color: #333; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <i class="fa-solid fa-users-viewfinder" style="color: #0a66c2;"></i> 
                    Candidate List (<%= job.applicants.length %>)
                </h3>

                <% if (job.applicants.length === 0) { %>
                    <p style="color: #666; font-style: italic; text-align: center; padding: 20px;">
                        No applications received yet.
                    </p>
                <% } else { %>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <% job.applicants.forEach(candidate => { %>
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 15px; border: 1px solid #f0f0f0; border-radius: 10px; transition: 0.3s;" onmouseover="this.style.backgroundColor='#f9f9f9'" onmouseout="this.style.backgroundColor='transparent'">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <img src="<%= candidate.profilePicture || '/assets/images/default.png' %>" 
                                         style="width: 55px; height: 55px; border-radius: 50%; object-fit: cover; border: 1px solid #eee;">
                                    <div>
                                        <h4 style="margin: 0; color: #333;"><%= candidate.firstName %> <%= candidate.lastName %></h4>
                                        <p style="margin: 2px 0 0; font-size: 13px; color: #666;"><%= candidate.headline %></p>
                                    </div>
                                </div>
                                <a href="/user/<%= candidate._id %>" class="btn-outline" style="padding: 6px 16px; font-size: 13px; border-radius: 20px; text-decoration: none; border: 1px solid #0a66c2; color: #0a66c2; font-weight: 600;">
                                    View Profile
                                </a>
                            </div>
                        <% }) %>
                    </div>
                <% } %>
            </div>
        <% } %>

    </div>

    <script src="/js/main.js"></script>
</body>
</html>